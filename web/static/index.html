<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>grpc-tap</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div id="app">
  <header>
    <h1>grpc-tap</h1>
    <span class="stats" id="stats">0 calls</span>
    <div class="tab-group">
      <button class="tab-btn active" id="tab-events" onclick="switchView('events')">Events</button>
      <button class="tab-btn" id="tab-stats" onclick="switchView('stats')">Stats</button>
    </div>
    <div class="control-group">
      <button class="ctrl-btn" id="btn-pause" onclick="togglePause()">Pause</button>
      <button class="ctrl-btn" id="btn-clear" onclick="clearEvents()">Clear</button>
      <div class="export-group">
        <button class="ctrl-btn" onclick="exportData('json')">JSON</button>
        <button class="ctrl-btn" onclick="exportData('md')">Markdown</button>
      </div>
    </div>
    <input type="text" id="filter" placeholder="Filter (d>100ms error method ...)">
    <span class="status disconnected" id="status">connecting...</span>
  </header>
  <div id="table-wrap">
    <table>
      <thead>
        <tr>
          <th class="col-time">Time</th>
          <th class="col-method">Method</th>
          <th class="col-type">Type</th>
          <th class="col-dur">Duration</th>
          <th class="col-status">Status</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
  <div id="stats-wrap" style="display:none">
    <table>
      <thead>
        <tr>
          <th class="stats-col-count sortable" data-sort="count">Count</th>
          <th class="stats-col-errors sortable" data-sort="errors">Errors</th>
          <th class="stats-col-dur sortable" data-sort="avg">Avg</th>
          <th class="stats-col-dur sortable" data-sort="total">Total</th>
          <th class="stats-col-method">Method</th>
        </tr>
      </thead>
      <tbody id="stats-tbody"></tbody>
    </table>
  </div>
  <div id="detail">
    <div id="detail-content">
      <div class="detail-row"><span class="detail-label">Method:</span><span class="detail-value" id="d-method"></span></div>
      <div class="detail-row"><span class="detail-label">Time:</span><span class="detail-value" id="d-time"></span></div>
      <div class="detail-row"><span class="detail-label">Duration:</span><span class="detail-value" id="d-dur"></span></div>
      <div class="detail-row"><span class="detail-label">Protocol:</span><span class="detail-value" id="d-protocol"></span></div>
      <div class="detail-row"><span class="detail-label">Type:</span><span class="detail-value" id="d-calltype"></span></div>
      <div class="detail-row"><span class="detail-label">Status:</span><span class="detail-value" id="d-status"></span></div>
      <div class="detail-row" id="d-err-row"><span class="detail-label">Error:</span><span class="detail-value" id="d-err" style="color:#f44747"></span></div>
      <div class="detail-section" id="d-req-headers-section">
        <div class="detail-section-title" onclick="toggleSection('req-headers')">
          <span class="section-chevron" id="chevron-req-headers">▸</span> Request Headers
        </div>
        <pre class="detail-pre collapsed" id="d-req-headers"></pre>
      </div>
      <div class="detail-section" id="d-res-headers-section">
        <div class="detail-section-title" onclick="toggleSection('res-headers')">
          <span class="section-chevron" id="chevron-res-headers">▸</span> Response Headers
        </div>
        <pre class="detail-pre collapsed" id="d-res-headers"></pre>
      </div>
      <div class="detail-section" id="d-req-body-section">
        <div class="detail-section-title" onclick="toggleSection('req-body')">
          <span class="section-chevron" id="chevron-req-body">▸</span> Request Body
        </div>
        <pre class="detail-pre collapsed" id="d-req-body"></pre>
      </div>
      <div class="detail-section" id="d-res-body-section">
        <div class="detail-section-title" onclick="toggleSection('res-body')">
          <span class="section-chevron" id="chevron-res-body">▸</span> Response Body
        </div>
        <pre class="detail-pre collapsed" id="d-res-body"></pre>
      </div>
      <div class="detail-buttons">
        <button class="btn" onclick="copyBody('request')">Copy Request</button>
        <button class="btn" onclick="copyBody('response')">Copy Response</button>
        <button class="btn" id="btn-replay" onclick="replayRequest()">Replay</button>
      </div>
      <div id="replay-output">
        <pre id="replay-pre"></pre>
      </div>
    </div>
  </div>
  <div id="stats-detail">
    <div id="stats-detail-content">
      <div class="detail-row" id="sd-metrics"></div>
      <div class="detail-row"><span class="detail-label">Method:</span></div>
      <div class="detail-method" id="sd-method"></div>
      <div class="detail-buttons">
        <button class="btn" onclick="copyStatsMethod()">Copy Method</button>
      </div>
    </div>
  </div>
</div>
<div id="toast"></div>
<script src="app.js"></script>
</body>
</html>
